# Hướng Dẫn Lắp Đặt Phần Cứng

Hướng dẫn chi tiết đấu nối dây cho Hệ thống Phân loại Trái cây AI trên Băng chuyền.

## ⚠️ An Toàn Trước Tiên

- **Ngắt nguồn điện** trước khi thực hiện bất kỳ kết nối nào
- **Kiểm tra kỹ cực tính (+/-)** để tránh làm hỏng linh kiện
- **Sử dụng nguồn điện phù hợp** (5V 3A cho Raspberry Pi)
- **Bọc cách điện các mối nối** để tránh chập mạch

## 📋 Danh Sách Linh Kiện

| Linh kiện | Số lượng | Ghi chú |
|-----------|----------|---------|
| Raspberry Pi 4 (8GB) | 1 | Bộ điều khiển chính |
| Nguồn 5V 3A | 1 | Cấp nguồn cho Raspberry Pi |
| Module Camera 5MP | 1 | Hỗ trợ 1080p |
| Động cơ Servo MG996R | 1 | Xoay 180° |
| Buck Converter LM2596 | 1 | Hạ áp 12V → 6V cho Servo |
| Mạch điều khiển động cơ L298N | 1 | Cầu H kép |
| Động cơ băng chuyền JGB37-545 | 1 | Motor DC 12V có hộp số |
| Nguồn 12V | 1 | Cho động cơ và Servo (3A trở lên) |
| Cảm biến hồng ngoại IR | 1 | Phát hiện trái cây |
| Breadboard | 1 | Để thử nghiệm mạch |
| Dây jumper | 20+ | Đực-cái, đực-đực |

## 🔌 Sơ Đồ Chân GPIO

### Cấu hình chân GPIO (Chế độ BCM)

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                    RASPBERRY PI 4 - SƠ ĐỒ CHÂN GPIO                       ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║    Chân vật lý    │    Tên BCM    │    Chức năng trong dự án             ║
║   ─────────────────────────────────────────────────────────────────       ║
║                                                                           ║
║     ┌─────────────────────────────────────────┐                          ║
║     │  (Pin 1)  3.3V  ●──────────● 5V (Pin 2) │ ← Nguồn cảm biến IR      ║
║     │  (Pin 3)  GPIO2 ●──────────● 5V (Pin 4) │                          ║
║     │  (Pin 5)  GPIO3 ●──────────● GND(Pin 6) │ ← Mass chung             ║
║     │  (Pin 7)  GPIO4 ●──────────● GPIO14     │                          ║
║     │  (Pin 9)  GND   ●──────────● GPIO15     │                          ║
║     │  (Pin 11) GPIO17●──────────● GPIO18     │ ← ENA(L298N) / Servo PWM ║
║     │  (Pin 13) GPIO27●──────────● GND        │ ← IN1 (L298N)            ║
║     │  (Pin 15) GPIO22●──────────● GPIO23     │ ← IN2 (L298N) / IR OUT   ║
║     │  (Pin 17) 3.3V  ●──────────● GPIO24     │                          ║
║     │  (Pin 19) GPIO10●──────────● GND        │                          ║
║     └─────────────────────────────────────────┘                          ║
║                                                                           ║
║   📍 CHÂN SỬ DỤNG TRONG DỰ ÁN:                                           ║
║   ┌─────────────────────────────────────────────────────────────┐        ║
║   │  GPIO 17 (Pin 11) → ENA của L298N (điều khiển tốc độ PWM)  │        ║
║   │  GPIO 27 (Pin 13) → IN1 của L298N (điều khiển chiều quay)  │        ║
║   │  GPIO 22 (Pin 15) → IN2 của L298N (điều khiển chiều quay)  │        ║
║   │  GPIO 18 (Pin 12) → Tín hiệu PWM của Servo                  │        ║
║   │  GPIO 23 (Pin 16) → Tín hiệu OUT của cảm biến IR            │        ║
║   │  5V      (Pin 2)  → Nguồn cho cảm biến IR (Servo dùng LM2596)│        ║
║   │  GND     (Pin 6)  → Mass chung cho tất cả linh kiện         │        ║
║   └─────────────────────────────────────────────────────────────┘        ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

---

## 🎥 Kết Nối Module Camera

### Hướng dẫn gắn cáp ribbon Camera:

1. Tìm **cổng CSI camera** trên Raspberry Pi (nằm giữa cổng HDMI và jack âm thanh)
2. Nhẹ nhàng kéo **clip nhựa đen** lên
3. Cắm cáp ribbon với **mặt xanh hướng về phía jack âm thanh**
4. Các điểm tiếp xúc phải **hướng ra xa** jack âm thanh
5. Ấn clip nhựa đen xuống để cố định

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                    MODULE CAMERA 5MP - SƠ ĐỒ KẾT NỐI                      ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║                        ┌─────────────────────┐                            ║
║                        │   ┌─────────────┐   │                            ║
║                        │   │  ◉ Camera   │   │  ← Ống kính camera        ║
║                        │   │    5MP      │   │                            ║
║                        │   └─────────────┘   │                            ║
║                        │     Module Camera   │                            ║
║                        └──────────┬──────────┘                            ║
║                                   │                                       ║
║                          Cáp Ribbon (15 pin)                              ║
║                                   │                                       ║
║                    ┌──────────────▼──────────────┐                        ║
║                    │      Raspberry Pi 4         │                        ║
║                    │                             │                        ║
║                    │  ┌─────┐ ┌─────┐ ┌─────┐   │                        ║
║                    │  │HDMI │ │ CSI │ │Audio│   │                        ║
║                    │  └─────┘ └──▲──┘ └─────┘   │                        ║
║                    │             │               │                        ║
║                    │        Cổng Camera          │                        ║
║                    └─────────────────────────────┘                        ║
║                                                                           ║
║   📝 CÁCH CẮM CÁP RIBBON:                                                ║
║   ┌─────────────────────────────────────────────────────────────┐        ║
║   │                                                             │        ║
║   │    Bước 1: Kéo clip đen lên    Bước 2: Cắm cáp vào         │        ║
║   │         ┌─────┐                    ┌─────┐                  │        ║
║   │         │▒▒▒▒▒│ ← Clip mở         │█████│ ← Cáp đã cắm     │        ║
║   │         │     │                    │▒▒▒▒▒│                  │        ║
║   │         └─────┘                    └─────┘                  │        ║
║   │                                                             │        ║
║   │    ⚠️  Mặt XANH của cáp hướng về phía jack AUDIO           │        ║
║   │    ⚠️  Các chân tiếp xúc (màu bạc) hướng về phía HDMI      │        ║
║   │                                                             │        ║
║   └─────────────────────────────────────────────────────────────┘        ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

---

## 🎯 Đấu Nối Động Cơ Servo (MG996R)

### Thông số kỹ thuật Servo:
- Điện áp hoạt động: 4.8V - 6V
- Tín hiệu điều khiển: PWM (50Hz)
- Góc quay: 0° - 180°

### Bảng kết nối:

| Dây Servo | Màu sắc | Kết nối với |
|-----------|---------|-------------|
| Tín hiệu (Signal) | Cam/Vàng | GPIO 18 (Pin 12) |
| Nguồn (Power) | Đỏ | 6V (từ LM2596 OUT+) |
| Mass (Ground) | Nâu/Đen | GND (LM2596 OUT- + Pi GND) |

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                    SERVO MG996R - SƠ ĐỒ ĐẤU NỐI CHI TIẾT                  ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║         SERVO MG996R                          RASPBERRY PI 4              ║
║      ┌─────────────────┐                  ┌─────────────────────┐        ║
║      │   ┌─────────┐   │                  │                     │        ║
║      │   │  ████   │   │                  │                     │        ║
║      │   │  ████   │   │  Dây ĐỎ         │   (Không nối vào Pi)│        ║
║      │   └────┬────┘   │ ═══► LM2596 OUT+ (6V)                  │        ║
║      │   Cánh Servo    │                  │                     │        ║
║      │                 │                  │   Pin 6  ●──── GND  │        ║
║      └────────┬────────┘                  │          │          │        ║
║               │                           │          │          │        ║
║        ┌──────┼──────┐   Dây NÂU         │   Pin 6  ●──── GND  │        ║
║        │      │      │ ═══► LM2596 OUT- (nối chung Pi GND)      │        ║
║        │  ┌───┴───┐  │                    │                     │        ║
║        │  │3 dây  │  │                    │  Pin 12 ●──── GPIO18│        ║
║        │  │ra từ  │  │   Dây CAM         │          │          │        ║
║        │  │servo  │  │ ══════════════════════════════┘          │        ║
║        │  └───────┘  │                    │                     │        ║
║        │ CAM ĐỎ NÂU  │                    └─────────────────────┘        ║
║        └─────────────┘                                                   ║
║                                                                           ║
║   📍 BẢNG MÀU DÂY SERVO:                                                 ║
║   ┌─────────────────────────────────────────────────────────────┐        ║
║   │                                                             │        ║
║   │    🟠 DÂY CAM/VÀNG  → Tín hiệu PWM    → GPIO 18 (Pin 12)   │        ║
║   │    🔴 DÂY ĐỎ        → Nguồn dương 6V  → LM2596 OUT+        │        ║
║   │    🟤 DÂY NÂU/ĐEN   → Mass (Ground)   → LM2596 OUT- (=GND) │        ║
║   │                                                             │        ║
║   └─────────────────────────────────────────────────────────────┘        ║
║                                                                           ║
║   ⚠️  LƯU Ý QUAN TRỌNG:                                                  ║
║   • BẮT BUỘC dùng Buck Converter LM2596 (chỉnh 6V) cho Servo MG996R    ║
║   • KHÔNG cấp nguồn từ Pi 5V → gây reset Pi hoặc cháy mạch             ║
║   • Phải nối mass chung: LM2596 OUT- = Pi GND (Pin 6)                   ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝

### Sơ đồ cấp nguồn Servo với LM2596 (Khuyến nghị cho tải nặng):

```
╔═══════════════════════════════════════════════════════════════════════════╗
║            CẤP NGUỒN SERVO VỚI BUCK CONVERTER LM2596                      ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║                      NGUỒN 12V DC                                         ║
║                    ┌──────────────┐                                       ║
║                    │   +    -     │                                       ║
║                    └───┬────┬─────┘                                       ║
║                        │    │                                             ║
║          ┌─────────────┘    └─────────────┐                              ║
║          │                                │                               ║
║          ▼                                ▼                               ║
║   ┌──────────────────────────────────────────┐                           ║
║   │         BUCK CONVERTER LM2596            │                           ║
║   │                                          │                           ║
║   │   ┌────────────────────────────────┐    │                           ║
║   │   │  IN+   IN-   OUT+   OUT-       │    │                           ║
║   │   │   ●     ●     ●      ●         │    │                           ║
║   │   └───┼─────┼─────┼──────┼─────────┘    │                           ║
║   │       │     │     │      │              │                           ║
║   │   12V+│  12V-│    │      │              │                           ║
║   │       │     │     │      │              │                           ║
║   │   ┌───────────────┐                     │                           ║
║   │   │ ○ Biến trở    │ ← Xoay để chỉnh    │                           ║
║   │   │   điều chỉnh  │   điện áp ra = 6V  │                           ║
║   │   └───────────────┘                     │                           ║
║   │                                          │                           ║
║   │   📍 CÁCH CHỈNH ĐIỆN ÁP:                │                           ║
║   │   • Dùng đồng hồ VOM đo OUT+ và OUT-    │                           ║
║   │   • Xoay biến trở cho đến khi = 6V      │                           ║
║   │   • MG996R hoạt động tốt nhất ở 6V      │                           ║
║   │                                          │                           ║
║   └──────────────────────────────────────────┘                           ║
║                        │      │                                          ║
║                   OUT+ │      │ OUT-                                     ║
║                   (6V) │      │ (GND)                                    ║
║                        │      │                                          ║
║          ┌─────────────┘      └───────────────┐                         ║
║          │                                    │                          ║
║          ▼                                    ▼                          ║
║   ┌─────────────────────────────────────────────────┐                   ║
║   │              SERVO MG996R                       │                   ║
║   │                                                 │                   ║
║   │    VCC (Đỏ) ◄────────────── 6V (từ LM2596)     │                   ║
║   │    GND (Nâu) ◄────────────── GND (từ LM2596)   │                   ║
║   │    Signal (Cam) ◄─────────── GPIO 18 (Pi)      │                   ║
║   │                                                 │                   ║
║   └─────────────────────────────────────────────────┘                   ║
║                                    │                                     ║
║   ┌────────────────────────────────┴─────────────────────────┐          ║
║   │                    RASPBERRY PI 4                        │          ║
║   │                                                          │          ║
║   │    GPIO 18 (Pin 12) ───────► Tín hiệu điều khiển Servo  │          ║
║   │    GND (Pin 6) ────────────► Nối chung với GND LM2596   │          ║
║   │                                                          │          ║
║   └──────────────────────────────────────────────────────────┘          ║
║                                                                          ║
║   ⚠️  QUAN TRỌNG - MASS CHUNG:                                          ║
║   ┌─────────────────────────────────────────────────────────────┐       ║
║   │                                                             │       ║
║   │   GND của LM2596 ──┬── GND của Servo (dây Nâu)             │       ║
║   │                    │                                        │       ║
║   │                    └── GND của Raspberry Pi (Pin 6)        │       ║
║   │                                                             │       ║
║   │   ⚡ Nếu không nối mass chung → Servo sẽ KHÔNG hoạt động!  │       ║
║   │                                                             │       ║
║   └─────────────────────────────────────────────────────────────┘       ║
║                                                                          ║
╚══════════════════════════════════════════════════════════════════════════╝
```

> **Lưu ý**: Sử dụng Buck Converter LM2596 chỉnh 6V cho servo MG996R khi hoạt động tải nặng. Phải nối mass chung giữa LM2596 và Raspberry Pi.

## 🚗 Đấu Nối Động Cơ Băng Chuyền + Mạch Điều Khiển L298N

### Thông số kỹ thuật L298N:
- Điện áp hoạt động: 5V - 35V
- Dòng tối đa: 2A mỗi kênh
- Điện áp logic: 5V

### Sơ đồ chi tiết mạch L298N:

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                    MẠCH ĐIỀU KHIỂN L298N - CẤU TẠO                        ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║                         NHÌN TỪ TRÊN XUỐNG                               ║
║                                                                           ║
║              ┌─────────────────────────────────────┐                     ║
║              │          MẠCH L298N                 │                     ║
║              │                                     │                     ║
║              │   ┌─────┐       ┌─────┐            │                     ║
║              │   │CHIP │       │CHIP │  ← IC L298N│                     ║
║              │   │L298N│       │     │            │                     ║
║              │   └─────┘       └─────┘            │                     ║
║              │                                     │                     ║
║              │   ┌─────────────────────────────┐  │                     ║
║              │   │    TẢN NHIỆT (HEATSINK)     │  │                     ║
║              │   └─────────────────────────────┘  │                     ║
║              │                                     │                     ║
║              │  OUT1  OUT2        OUT3  OUT4      │ ← Ngõ ra motor      ║
║              │   ●     ●          ●     ●        │                     ║
║              └───┼─────┼──────────┼─────┼────────┘                     ║
║                  │     │          │     │                               ║
║              ┌───┴─────┴───┐  (không dùng OUT3,4)                       ║
║              │  MOTOR DC   │                                            ║
║              │ BĂNG CHUYỀN │                                            ║
║              └─────────────┘                                            ║
║                                                                           ║
║   📍 CÁC CHÂN PHÍA TRÊN MẠCH L298N:                                      ║
║   ┌─────────────────────────────────────────────────────────────┐        ║
║   │                                                             │        ║
║   │  ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐        │        ║
║   │  │ 12V │ GND │ 5V  │ ENA │ IN1 │ IN2 │ IN3 │ IN4 │        │        ║
║   │  └──┬──┴──┬──┴──┬──┴──┬──┴──┬──┴──┬──┴─────┴─────┘        │        ║
║   │     │     │     │     │     │                               │        ║
║   │     │     │     │     │     └── GPIO 22 (Pin 15)           │        ║
║   │     │     │     │     └──────── GPIO 27 (Pin 13)           │        ║
║   │     │     │     └────────────── GPIO 17 (Pin 11)           │        ║
║   │     │     └──────────────────── KHÔNG DÙNG (gỡ jumper)     │        ║
║   │     └────────────────────────── Nối với GND của Pi và 12V- │        ║
║   │     └────────────────────────── Nguồn 12V dương (+)        │        ║
║   │                                                             │        ║
║   └─────────────────────────────────────────────────────────────┘        ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

### Kết nối nguồn điện:

| Chân L298N | Kết nối với |
|------------|-------------|
| 12V | Nguồn 12V (+) dương |
| GND | Nguồn 12V (-) âm VÀ GND của Raspberry Pi |
| 5V Output | **KHÔNG SỬ DỤNG** (gỡ jumper nếu có) |

### Kết nối động cơ:

| Chân L298N | Kết nối với |
|------------|-------------|
| OUT1 | Động cơ băng chuyền (+) |
| OUT2 | Động cơ băng chuyền (-) |

### Kết nối điều khiển (từ Raspberry Pi):

| Chân L298N | Chân GPIO (BCM) | Chân vật lý | Chức năng |
|------------|-----------------|-------------|-----------|
| ENA | GPIO 17 | Pin 11 | Điều khiển tốc độ (PWM) |
| IN1 | GPIO 27 | Pin 13 | Điều khiển chiều quay |
| IN2 | GPIO 22 | Pin 15 | Điều khiển chiều quay |

### Sơ đồ đấu nối hoàn chỉnh:

```
╔═══════════════════════════════════════════════════════════════════════════╗
║              L298N + MOTOR BĂNG CHUYỀN - SƠ ĐỒ ĐẤU NỐI ĐẦY ĐỦ            ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║                         NGUỒN 12V DC                                      ║
║                    ┌────────┬────────┐                                   ║
║                    │   +    │   -    │                                   ║
║                    │  12V   │  GND   │                                   ║
║                    └────┬───┴────┬───┘                                   ║
║                         │        │                                        ║
║          ┌──────────────┘        └──────────────┐                        ║
║          │                                      │                        ║
║          ▼                                      ▼                        ║
║   ┌──────────────────────────────────────────────────┐                  ║
║   │              MẠCH ĐIỀU KHIỂN L298N               │                  ║
║   │                                                  │                  ║
║   │    12V   GND   5V   ENA   IN1   IN2   ENB       │                  ║
║   │     ●     ●    ●     ●     ●     ●     ●        │                  ║
║   │     │     │    │     │     │     │              │                  ║
║   │     │     │    │     │     │     │              │                  ║
║   └─────┼─────┼────┼─────┼─────┼─────┼──────────────┘                  ║
║         │     │    │     │     │     │                                  ║
║    Nguồn│     │    │     │     │     │                                  ║
║    12V+ │     │  Không   │     │     │                                  ║
║         │     │  dùng    │     │     │                                  ║
║         │     │          │     │     │                                  ║
║         │     │          │     │     │                                  ║
║         │     │          │     │     │                                  ║
║   ┌─────────────────────────────────────────────────────┐               ║
║   │                 RASPBERRY PI 4                      │               ║
║   │                                                     │               ║
║   │    Pin 6 (GND) ────────────────────────┐           │               ║
║   │    Pin 11 (GPIO 17) ─────────┐         │           │               ║
║   │    Pin 13 (GPIO 27) ───────┐ │         │           │               ║
║   │    Pin 15 (GPIO 22) ─────┐ │ │         │           │               ║
║   │                          │ │ │         │           │               ║
║   └──────────────────────────┼─┼─┼─────────┼───────────┘               ║
║                              │ │ │         │                            ║
║                              │ │ │         │                            ║
║         Kết nối với L298N:   │ │ │         │                            ║
║         IN2 ◄────────────────┘ │ │         │                            ║
║         IN1 ◄──────────────────┘ │         │                            ║
║         ENA ◄────────────────────┘         │                            ║
║         GND ◄──────────────────────────────┘                            ║
║                                                                          ║
║   ┌──────────────────────────────────────────────────┐                  ║
║   │              MẠCH ĐIỀU KHIỂN L298N               │                  ║
║   │                                                  │                  ║
║   │    OUT1   OUT2                                   │                  ║
║   │     ●      ●                                     │                  ║
║   └─────┼──────┼─────────────────────────────────────┘                  ║
║         │      │                                                        ║
║         │      │                                                        ║
║    ┌────┴──────┴────┐                                                   ║
║    │  MOTOR DC 12V  │                                                   ║
║    │  BĂNG CHUYỀN   │                                                   ║
║    │  JGB37-545     │                                                   ║
║    └────────────────┘                                                   ║
║                                                                          ║
╚══════════════════════════════════════════════════════════════════════════╝
```

### ⚠️ Lưu ý quan trọng:
- **Mass chung (Common Ground)**: Phải nối GND của Raspberry Pi với GND của L298N
- **Jumper ENA**: Gỡ jumper ENA để điều khiển tốc độ bằng PWM
- **Chiều quay motor**: Nếu motor quay ngược, đổi vị trí OUT1 và OUT2

## 📡 Cảm Biến Hồng Ngoại IR (Phát hiện trái cây)

### Thông số kỹ thuật cảm biến IR:
- Điện áp hoạt động: 3.3V - 5V
- Ngõ ra: Digital (HIGH khi phát hiện vật thể)
- Khoảng cách phát hiện: 2-30cm (có thể điều chỉnh)

### Bảng kết nối:

| Chân cảm biến | Kết nối với |
|---------------|-------------|
| VCC | 5V (Pin 2) |
| GND | GND (Pin 6) |
| OUT | GPIO 23 (Pin 16) |

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                    CẢM BIẾN HỒNG NGOẠI IR - SƠ ĐỒ ĐẤU NỐI                 ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║                    CẤU TẠO CẢM BIẾN IR FC-51                             ║
║                                                                           ║
║              ┌─────────────────────────────┐                             ║
║              │       CẢM BIẾN IR           │                             ║
║              │                             │                             ║
║              │   ┌───────┐   ┌───────┐    │                             ║
║              │   │ ◯ TX  │   │ ◯ RX  │    │  ← LED phát và thu IR       ║
║              │   │(phát) │   │(nhận) │    │                             ║
║              │   └───────┘   └───────┘    │                             ║
║              │                             │                             ║
║              │      ┌─────────────┐        │                             ║
║              │      │  ○ Biến trở │        │  ← Điều chỉnh độ nhạy      ║
║              │      └─────────────┘        │                             ║
║              │                             │                             ║
║              │   ● LED báo nguồn (đỏ)      │                             ║
║              │   ● LED báo phát hiện (xanh)│                             ║
║              │                             │                             ║
║              └──────────┬──────────────────┘                             ║
║                         │                                                ║
║              ┌──────────┴──────────┐                                     ║
║              │  VCC   GND   OUT    │  ← 3 chân kết nối                  ║
║              │   │     │     │     │                                     ║
║              └───┼─────┼─────┼─────┘                                     ║
║                  │     │     │                                           ║
║                  │     │     │                                           ║
║                  │     │     │                                           ║
║   ┌──────────────┼─────┼─────┼──────────────────────────────┐           ║
║   │              │     │     │     RASPBERRY PI 4           │           ║
║   │              │     │     │                              │           ║
║   │              │     │     └────────► GPIO 23 (Pin 16)    │           ║
║   │              │     │               (Tín hiệu ra)        │           ║
║   │              │     │                                    │           ║
║   │              │     └──────────────► GND (Pin 6)         │           ║
║   │              │                     (Mass)               │           ║
║   │              │                                          │           ║
║   │              └────────────────────► 5V (Pin 2)          │           ║
║   │                                    (Nguồn dương)        │           ║
║   │                                                         │           ║
║   └─────────────────────────────────────────────────────────┘           ║
║                                                                          ║
║   📍 NGUYÊN LÝ HOẠT ĐỘNG:                                               ║
║   ┌─────────────────────────────────────────────────────────────┐       ║
║   │                                                             │       ║
║   │    TX (phát)        Vật thể         RX (nhận)              │       ║
║   │       ◯ ─ ─ ─ ─ ─► ┌─────┐ ◄─ ─ ─ ─ ◯                     │       ║
║   │    Tia hồng ngoại  │ 🍎  │  Tia phản xạ                    │       ║
║   │                    └─────┘                                  │       ║
║   │                                                             │       ║
║   │    • Không có vật → OUT = HIGH (1)                         │       ║
║   │    • Có vật phản xạ → OUT = LOW (0)                        │       ║
║   │    • Xoay biến trở để điều chỉnh khoảng cách phát hiện     │       ║
║   │                                                             │       ║
║   └─────────────────────────────────────────────────────────────┘       ║
║                                                                          ║
║   ⚠️  MẸO ĐIỀU CHỈNH:                                                   ║
║   • Xoay biến trở theo chiều kim đồng hồ → Tăng khoảng cách             ║
║   • Xoay biến trở ngược chiều kim đồng hồ → Giảm khoảng cách            ║
║   • LED xanh sáng = đang phát hiện vật thể                              ║
║                                                                          ║
╚══════════════════════════════════════════════════════════════════════════╝
```

## 🔋 Cấu Hình Nguồn Điện

### Phương án 1: Nguồn riêng biệt (Khuyến nghị)

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                    CẤU HÌNH NGUỒN ĐIỆN - PHƯƠNG ÁN 1                      ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║   ┌─────────────┐          ┌─────────────────────────┐                   ║
║   │  NGUỒN 5V   │          │                         │                   ║
║   │    3A       │═════════►│     RASPBERRY PI 4      │                   ║
║   │  (USB-C)    │          │                         │                   ║
║   └─────────────┘          │    ┌───────────────┐    │                   ║
║                            │    │ Cấp nguồn cho │    │                   ║
║                            │    │ • Cảm biến IR  │    │                   ║
║                            │    └───────────────┘    │                   ║
║                            └─────────────────────────┘                   ║
║                                                                           ║
║   ┌─────────────┐          ┌─────────────────────────┐                   ║
║   │  NGUỒN 12V  │          │    MẠCH L298N           │                   ║
║   │    3A+      │══════┬══►│                         │                   ║
║   │             │      │   │    ┌───────────────┐    │                   ║
║   └─────────────┘      │   │    │ Cấp nguồn cho │    │                   ║
║                        │   │    │ • Motor DC    │    │                   ║
║                        │   │    │   băng chuyền │    │                   ║
║                        │   │    └───────────────┘    │                   ║
║                        │   └─────────────────────────┘                   ║
║                        │                                               ║
║                        │   ┌─────────────────────────┐                   ║
║                        │   │  BUCK CONVERTER LM2596 │                   ║
║                        └══►│   12V → 6V (cho Servo) │                   ║
║                            │                         │                   ║
║                            │    ┌───────────────┐    │                   ║
║                            │    │ Cấp nguồn 6V  │    │                   ║
║                            │    │ • Servo MG996R│    │                   ║
║                            │    └───────────────┘    │                   ║
║                            └─────────────────────────┘                   ║
║                                                                           ║
║   ⚠️  QUAN TRỌNG:                                                        ║
║   • Phải nối GND của Pi với GND của L298N và LM2596 (Mass chung)        ║
║   • LM2596 chỉnh điện áp ra = 6V (dùng VOM đo)                           ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

### Phương án 2: Một nguồn với bộ chuyển đổi

Nếu chỉ dùng một nguồn 12V:
- Sử dụng **buck converter** để hạ 12V xuống 5V (3A) cho Raspberry Pi
- Cấp nguồn motor trực tiếp từ 12V
- **KHÔNG BAO GIỜ** cấp nguồn Pi từ chân 5V của L298N

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                    CẤU HÌNH NGUỒN ĐIỆN - PHƯƠNG ÁN 2                      ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║                         ┌─────────────┐                                   ║
║                         │  NGUỒN 12V  │                                   ║
║                         │    3A+      │                                   ║
║                         └──────┬──────┘                                   ║
║                                │                                          ║
║                    ┌───────────┴───────────┐                             ║
║                    │                       │                              ║
║                    ▼                       ▼                              ║
║         ┌──────────────────┐     ┌─────────────────┐                     ║
║         │  BUCK CONVERTER  │     │    MẠCH L298N   │                     ║
║         │    12V → 5V      │     │                 │                     ║
║         │     (3A)         │     │    Motor DC     │                     ║
║         └────────┬─────────┘     └─────────────────┘                     ║
║                  │                                                        ║
║                  ▼                                                        ║
║         ┌─────────────────┐                                              ║
║         │ RASPBERRY PI 4  │                                              ║
║         │  (qua GPIO 5V)  │                                              ║
║         └─────────────────┘                                              ║
║                                                                           ║
║   ⚠️  CHÚ Ý: Phương án này phức tạp hơn, dễ gây hư hỏng nếu sai         ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

## ⚡ Sơ Đồ Đấu Nối Hoàn Chỉnh Toàn Hệ Thống

```
╔═══════════════════════════════════════════════════════════════════════════════════════════════╗
║                              SƠ ĐỒ ĐẤU NỐI TỔNG THỂ HỆ THỐNG                                 ║
╠═══════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                               ║
║     NGUỒN 5V 3A                              NGUỒN 12V 3A                                     ║
║    ┌──────────┐                             ┌──────────┐                                     ║
║    │  5V  GND │                             │ 12V  GND │                                     ║
║    └──┬───┬───┘                             └──┬───┬───┘                                     ║
║       │   │                                    │   │                                          ║
║       │   │    USB-C                           │   │                                          ║
║       │   └─────────────┐                      │   │                                          ║
║       │                 │       ┌──────────────┴───┴─────────┐                               ║
║       │                 │       │                            │                               ║
║  ┌────┴─────────────────┴───────┼────────────────────────────┼───────────────────────────┐  ║
║  │                              │                            │                           │  ║
║  │         RASPBERRY PI 4       │                            │                           │  ║
║  │                              │                            │                           │  ║
║  │    ┌─────────────────────────┼────────────────────────────┼───────────────────────┐   │  ║
║  │    │      GPIO HEADER        │                            │                       │   │  ║
║  │    │                         │                            │                       │   │  ║
║  │    │   Pin 2 (5V) ─────┬─────┘                            │                       │   │  ║
║  │    │                   │                                  │                       │   │  ║
║  │    │   Pin 6 (GND) ────┼──────────┬───────────────────────┼────┐                  │   │  ║
║  │    │                   │          │                       │    │                  │   │  ║
║  │    │   Pin 11 (GPIO17)─┼──────────┼───────────────────┐   │    │                  │   │  ║
║  │    │                   │          │                   │   │    │                  │   │  ║
║  │    │   Pin 12 (GPIO18)─┼──────────┼───────────────┐   │   │    │                  │   │  ║
║  │    │                   │          │               │   │   │    │                  │   │  ║
║  │    │   Pin 13 (GPIO27)─┼──────────┼───────────┐   │   │   │    │                  │   │  ║
║  │    │                   │          │           │   │   │   │    │                  │   │  ║
║  │    │   Pin 15 (GPIO22)─┼──────────┼───────┐   │   │   │   │    │                  │   │  ║
║  │    │                   │          │       │   │   │   │   │    │                  │   │  ║
║  │    │   Pin 16 (GPIO23)─┼──────┐   │       │   │   │   │   │    │                  │   │  ║
║  │    │                   │      │   │       │   │   │   │   │    │                  │   │  ║
║  │    │   CSI Port ──Camera      │   │       │   │   │   │   │    │                  │   │  ║
║  │    │                   │      │   │       │   │   │   │   │    │                  │   │  ║
║  │    └───────────────────┼──────┼───┼───────┼───┼───┼───┼───┼────┼──────────────────┘   │  ║
║  │                        │      │   │       │   │   │   │   │    │                      │  ║
║  └────────────────────────┼──────┼───┼───────┼───┼───┼───┼───┼────┼──────────────────────┘  ║
║                           │      │   │       │   │   │   │   │    │                         ║
║   ┌───────────────────────┴──┐   │   │       │   │   │   │   │    │                         ║
║   │     CẢM BIẾN IR          │   │   │       │   │   │   │   │    │                         ║
║   │  ┌─────────────────────┐ │   │   │       │   │   │   │   │    │                         ║
║   │  │  VCC ◄──────────────┼─┘   │   │       │   │   │   │   │    │                         ║
║   │  │  GND ◄──────────────┼─────┼───┘       │   │   │   │   │    │                         ║
║   │  │  OUT ◄──────────────┼─────┼───────────┼───┼───┼───┼───┼────┘                         ║
║   │  └─────────────────────┘ │   │           │   │   │   │   │                              ║
║   └──────────────────────────┘   │           │   │   │   │   │                              ║
║                                  │           │   │   │   │   │                              ║
║      ┌───────────────────────────┴───────┐   │   │   │   │   │                              ║
║      │    BUCK CONVERTER LM2596          │   │   │   │   │   │                              ║
║      │    (12V → 6V cho Servo)           │   │   │   │   │   │                              ║
║      │                                   │   │   │   │   │   │                              ║
║      │   IN+ ◄─────────────────────────────────────────────┼─── Nguồn 12V (+)              ║
║      │   IN- ◄─────────────────────────────────────────────┼─── Nguồn 12V (-)              ║
║      │                                   │   │   │   │   │   │                              ║
║      │   OUT+ (6V) ────┐                 │   │   │   │   │   │                              ║
║      │   OUT- (GND) ───┼─────┐           │   │   │   │   │   │                              ║
║      └─────────────────┼─────┼───────────┘   │   │   │   │   │                              ║
║                        │     │               │   │   │   │   │                              ║
║   ┌────────────────────┴─────┴───┐           │   │   │   │   │                              ║
║   │      SERVO MG996R            │           │   │   │   │   │                              ║
║   │  ┌─────────────────────────┐ │           │   │   │   │   │                              ║
║   │  │  VCC (Đỏ) ◄─ 6V         │ │           │   │   │   │   │                              ║
║   │  │  GND (Nâu) ◄─ GND (nối  │ │           │   │   │   │   │                              ║
║   │  │                Pi GND)   │ │           │   │   │   │   │                              ║
║   │  │  Signal (Cam) ◄──────────┼─┼───────────┼───┘   │   │   │                              ║
║   │  └─────────────────────────┘ │           │       │   │   │                              ║
║   └──────────────────────────────┘           │       │   │   │                              ║
║                                              │       │   │   │                              ║
║   ┌──────────────────────────────────────────┴───────┴───┴───┴─────────┐                   ║
║   │                           MẠCH L298N                                │                   ║
║   │  ┌──────────────────────────────────────────────────────────────┐  │                   ║
║   │  │  12V ◄──────────────────────────────────── Nguồn 12V (+)     │  │                   ║
║   │  │  GND ◄──────────────────────────────────── Nguồn 12V (-)     │  │                   ║
║   │  │  ENA ◄──────────────────────────────────── GPIO 17           │  │                   ║
║   │  │  IN1 ◄──────────────────────────────────── GPIO 27           │  │                   ║
║   │  │  IN2 ◄──────────────────────────────────── GPIO 22           │  │                   ║
║   │  │  GND ◄──────────────────────────────────── Pi GND            │  │                   ║
║   │  └──────────────────────────────────────────────────────────────┘  │                   ║
║   │                                                                     │                   ║
║   │     OUT1 ────┬─── Motor DC (+)                                     │                   ║
║   │     OUT2 ────┴─── Motor DC (-)                                     │                   ║
║   └─────────────────────────────────────────────────────────────────────┘                   ║
║                       │                                                                      ║
║              ┌────────┴────────┐                                                            ║
║              │  MOTOR DC 12V   │                                                            ║
║              │  BĂNG CHUYỀN    │                                                            ║
║              └─────────────────┘                                                            ║
║                                                                                              ║
║   📍 LƯU Ý QUAN TRỌNG:                                                                      ║
║   • Servo KHÔNG nối vào Pi 5V - dùng LM2596 cấp 6V                                          ║
║   • Mass chung: Pi GND = L298N GND = LM2596 OUT- = Nguồn 12V (-)                           ║
║   • Nguồn 12V phân chia: L298N (motor) + LM2596 (servo)                                     ║
║                                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════════════════════╝
```

### 📋 Bảng tổng hợp kết nối:

| Linh kiện | Chân | Kết nối với |
|-----------|------|-------------|
| **Servo MG996R** | VCC (Đỏ) | LM2596 OUT+ (6V) |
| | GND (Nâu) | LM2596 OUT- (nối chung Pi GND) |
| | Signal (Cam) | GPIO 18 (Pin 12) |
| **LM2596** | IN+ | Nguồn 12V (+) |
| | IN- | Nguồn 12V (-) |
| | OUT+ | Servo VCC (6V) |
| | OUT- | Servo GND + Pi GND |
| **Cảm biến IR** | VCC | 5V (Pin 2) |
| | GND | GND (Pin 6) |
| | OUT | GPIO 23 (Pin 16) |
| **L298N** | 12V | Nguồn 12V (+) |
| | GND | Nguồn 12V (-) + Pi GND |
| | ENA | GPIO 17 (Pin 11) |
| | IN1 | GPIO 27 (Pin 13) |
| | IN2 | GPIO 22 (Pin 15) |
| **Camera** | Cáp ribbon | Cổng CSI |
| **Motor DC** | (+) | L298N OUT1 |
| | (-) | L298N OUT2 |

## 🧪 Quy Trình Kiểm Tra

### 1. Kiểm tra chân GPIO
```bash
# Kiểm tra từng GPIO
gpio readall  # Nếu đã cài tiện ích gpio
```

### 2. Kiểm tra Servo
```bash
cd raspberry-pi
python motor_controller.py
```

### 3. Kiểm tra băng chuyền
```bash
# Chạy module điều khiển motor
# Servo sẽ quay và băng chuyền sẽ chạy/dừng
```

### 4. Kiểm tra Camera
```bash
cd raspberry-pi
python camera_module.py
```

### 5. Kiểm tra cảm biến
```bash
# Theo dõi GPIO 23
gpio -g mode 23 in
gpio -g read 23
```

## 🐛 Xử Lý Sự Cố Phần Cứng

### Servo không quay
- Kiểm tra tín hiệu PWM trên GPIO 18
- Xác nhận kết nối nguồn 5V
- Thử với nguồn 5V bên ngoài

### Băng chuyền không chạy
- Kiểm tra nguồn 12V
- Xác nhận kết nối L298N
- Test motor trực tiếp với nguồn 12V
- Kiểm tra đã gỡ jumper ENA chưa

### Camera không nhận diện
```bash
vcgencmd get_camera
# Phải hiển thị: supported=1 detected=1

# Bật giao diện camera
sudo raspi-config
# Interface Options → Camera → Enable
```

### Cảm biến không phát hiện
- Điều chỉnh biến trở độ nhạy trên cảm biến
- Kiểm tra khoảng cách phát hiện (thường 2-30cm)
- Test với vật thể phản xạ tốt

## 📐 Lắp Ráp Cơ Khí

### Thiết lập băng chuyền
1. Gắn chắc chắn motor băng chuyền
2. Căn chỉnh dây đai cho hoạt động mượt mà
3. Đặt servo tại vị trí phân loại
4. Gắn camera phía trên băng chuyền với góc nhìn rõ ràng

### Cơ cấu phân loại
- Cánh servo sẽ đẩy vật tại ngã ba
- **Giữa (90°)**: Vật đi thẳng
- **Trái (30°)**: Vật rẽ trái
- **Phải (150°)**: Vật rẽ phải

### Vị trí cảm biến
- Đặt cảm biến IR **trước** camera
- Cho phép có thời gian chụp ảnh
- Chiều cao: Điều chỉnh để phát hiện trái cây một cách đáng tin cậy

```
╔═══════════════════════════════════════════════════════════════════════════╗
║                    SƠ ĐỒ BỐ TRÍ HỆ THỐNG BĂNG CHUYỀN                      ║
╠═══════════════════════════════════════════════════════════════════════════╣
║                                                                           ║
║   Hướng di chuyển trái cây: ═══════════════════════════►                 ║
║                                                                           ║
║                                                                           ║
║           CẢM BIẾN IR        CAMERA           SERVO                      ║
║               │                 │               │                        ║
║               ▼                 ▼               ▼                        ║
║                                                                           ║
║            ┌─────┐          ┌─────┐         ┌─────┐                      ║
║            │ ▓▓▓ │          │ ◉   │         │  \  │                      ║
║            │ ▓▓▓ │          │     │         │   \ │ ← Cánh Servo         ║
║            └──┬──┘          └──┬──┘         └──┬──┘                      ║
║               │                │               │                         ║
║   ════════════╪════════════════╪═══════════════╪════════════════════    ║
║   ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒  ║
║   ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ BĂNG CHUYỀN ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒  ║
║   ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒  ║
║   ════════════════════════════════════════════════╦══════════════════    ║
║               │                │                  ║                      ║
║            PHÁT HIỆN        CHỤP ẢNH           PHÂN LOẠI                ║
║            trái cây        & Nhận dạng                                   ║
║                                                   ║                      ║
║                                              ┌────╨────┐                 ║
║                                              │ THÙNG   │                 ║
║                                              │ PHÂN    │                 ║
║                                              │ LOẠI    │                 ║
║                                              └─────────┘                 ║
║                                                                           ║
║   📝 QUY TRÌNH HOẠT ĐỘNG:                                                ║
║   ┌─────────────────────────────────────────────────────────────┐        ║
║   │                                                             │        ║
║   │   1️⃣  Trái cây đi trên băng chuyền                          │        ║
║   │   2️⃣  Cảm biến IR phát hiện → Dừng băng chuyền              │        ║
║   │   3️⃣  Camera chụp ảnh                                       │        ║
║   │   4️⃣  AI phân tích → Tươi/Hư/Khác                          │        ║
║   │   5️⃣  Servo xoay đúng hướng                                │        ║
║   │   6️⃣  Băng chuyền chạy tiếp                                │        ║
║   │   7️⃣  Trái cây được phân loại vào đúng thùng               │        ║
║   │                                                             │        ║
║   └─────────────────────────────────────────────────────────────┘        ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝
```

## ✅ Danh Sách Kiểm Tra Cuối Cùng

- [ ] Tất cả nguồn điện đã kết nối đúng
- [ ] Mass chung đã được thiết lập
- [ ] Servo đã test (trái, giữa, phải)
- [ ] Motor băng chuyền đã test (chạy/dừng)
- [ ] Camera đã nhận diện và test
- [ ] Cảm biến phát hiện ổn định
- [ ] Không có kết nối lỏng
- [ ] Các mối nối đã được cách điện
- [ ] Nút dừng khẩn cấp có thể truy cập

## 🔧 Hiệu Chỉnh

Sau khi lắp đặt phần cứng, hiệu chỉnh trong [config.py](raspberry-pi/config.py):

```python
# Điều chỉnh các giá trị này dựa trên thiết lập của bạn
SERVO_ANGLE_LEFT = 30      # Góc servo cho phân loại trái
SERVO_ANGLE_CENTER = 90    # Góc servo cho đi thẳng  
SERVO_ANGLE_RIGHT = 150    # Góc servo cho phân loại phải

CONVEYOR_SPEED = 75        # Tốc độ băng chuyền (0-100)
```

---

**Có câu hỏi hoặc vấn đề? Xem [README chính](README.md) để khắc phục sự cố!**
